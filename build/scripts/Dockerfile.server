FROM node:14 AS build-stage

# Create svaefh directory
WORKDIR /usr/src/svaefh

# Install Nexe
RUN npm i nexe@3.3.7 -g

# Install svaefh Server Dependencies
COPY package*.json ./
RUN npm install --only=production

# Bundle svaefh Source
COPY . .

# Build
RUN nexe server.js -t linux-x64-12.14.1

# Copy to Build
FROM scratch AS export-stage
COPY --from=build-stage /usr/src/svaefh/server /
